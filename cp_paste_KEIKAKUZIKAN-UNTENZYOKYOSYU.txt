Sub cp_paste_KEIKAKUZIKAN_UNTENZYOKYOSYUKEI()

    Dim BNAME As String
    Dim SNAME As String
    Dim targetline As Integer
    
    If ActiveWorkbook.Name <> "計画時間.xlsx" Then
        MsgBox "現在アクティブなブック名が異常です。終了します。" & ActiveWorkbook.Name
        End
    End If
    
    
    Const BL As String = "BL3"  ' 対象BL
    
    
    Debug.Print "============================================================================================================"


    Select Case BL
        Case "BL1"
            Debug.Print "おはようございます！"
        Case "BL2"
            Debug.Print "こんにちは！"
        Case "BL3"
            Debug.Print ">>>BL3"
            
            '「シート GUN HV OFF」をコピーして貼り付け
            BNAME = "計画時間.xlsx"
            SNAME = "GUN HV OFF"
            Workbooks(BNAME).Worksheets(SNAME).Activate
            
            Debug.Print "Worksheets(SNAME).Name: " & Worksheets(SNAME).Name

            Range("G3:I" & Cells(Rows.Count, 7).End(xlUp).Row).Copy
            Range("G3:I" & Cells(Rows.Count, 7).End(xlUp).Row).Select
            If MsgBox("選択部分をコピーしました。" & vbCrLf & "次に進むにはYes", vbYesNo + vbQuestion, "確認") = vbNo Then End
            
            BNAME = "\\saclaopr18.spring8.or.jp\common\運転状況集計\最新\SACLA\SACLA運転状況集計BL3.xlsm"
            SNAME = "GUN HV OFF時間記録"
            Set wb1 = Workbooks.Open(BNAME, ReadOnly:=False)
            
            wb1.Worksheets(SNAME).Activate
            wb1.Worksheets(SNAME).Cells(5, 3).End(xlDown).Activate       ' セルC5「GUN HV OFF時間」から最終行へ
            Debug.Print "　wb1 GUN HV OFFシートの　Last: " & wb1.Worksheets(SNAME).Cells(5, 3).End(xlDown).Row
            targetline = wb1.Worksheets(SNAME).Cells(5, 3).End(xlDown).Row + 1
            wb1.Worksheets(SNAME).Cells(targetline, 3).Activate
            If MsgBox("ここに値「GUN HV OFF時間」を貼り付けますか？", vbYesNo + vbQuestion, "GUN HV OFF") = vbYes Then
                wb1.Worksheets(SNAME).Cells(wb1.Worksheets(SNAME).Cells(Rows.Count, 3).End(xlUp).Row + 1, 3).PasteSpecial Paste:=xlPasteValues
            End If
            If MsgBox("貼り付けましたがOKですか？？" & vbCrLf & "次に進むにはYes", vbYesNo + vbQuestion, "確認") = vbNo Then End
            
            
            
            '「シート bl3」をコピーして貼り付け
            BNAME = "計画時間.xlsx"
            SNAME = "bl3"
            Workbooks(BNAME).Worksheets("bl3").Activate
            Range("A2:C" & Cells(Rows.Count - 1, 1).End(xlUp).Row).Select
            Range("A2:C" & Cells(Rows.Count - 1, 1).End(xlUp).Row).Copy
            If MsgBox("選択部分をコピーしました。" & vbCrLf & "次に進むにはYes", vbYesNo + vbQuestion, "確認") = vbNo Then End

            SNAME = "運転予定時間"
            wb1.Worksheets(SNAME).Activate
            wb1.Worksheets(SNAME).Range("B3").End(xlDown).Activate       ' セルB3[運転種別]から最終行へ
            Debug.Print "wb1 Last: " & wb1.Worksheets(SNAME).Range("B3").End(xlDown).Row
            targetline = wb1.Worksheets(SNAME).Range("B3").End(xlDown).Row + 1
            wb1.Worksheets(SNAME).Cells(targetline, 2).Activate
            If MsgBox("ここに値を貼り付けますか？", vbYesNo + vbQuestion, "確認") = vbYes Then
                wb1.Worksheets(SNAME).Cells(targetline, 2).PasteSpecial Paste:=xlPasteValues
            End If
            If MsgBox("貼り付けましたがOKですか？？" & vbCrLf & "次に進むにはYes", vbYesNo + vbQuestion, "確認") = vbNo Then End

            
            '「シート bl3の備考列」をコピーして貼り付け
            BNAME = "計画時間.xlsx"
            SNAME = "bl3"
            Workbooks(BNAME).Worksheets("bl3").Activate
            Range("D2:D" & Cells(Rows.Count - 1, 1).End(xlUp).Row).Select
            Range("D2:D" & Cells(Rows.Count - 1, 1).End(xlUp).Row).Copy
            If MsgBox("選択部分をコピーしました。" & vbCrLf & "次に進むにはYes", vbYesNo + vbQuestion, "確認") = vbNo Then End
            SNAME = "運転予定時間"
            wb1.Worksheets(SNAME).Activate
            wb1.Worksheets(SNAME).Range("B3").End(xlDown).Activate       ' セルB3[運転種別]から最終行へ
            wb1.Worksheets(SNAME).Cells(targetline, 7).Activate
            If MsgBox("ここに値を貼り付けますか？", vbYesNo + vbQuestion, "確認") = vbYes Then
                wb1.Worksheets(SNAME).Cells(targetline, 7).PasteSpecial Paste:=xlPasteValues
            End If
                       
            
            
            
            Dim before_unit As String
            Dim latest_unit As Integer
            Dim newunit As String
            wb1.Worksheets(SNAME).Cells(targetline - 1, 1).Select
            before_unit = wb1.Worksheets(SNAME).Cells(targetline - 1, 1)
            Debug.Print "before_unit: " & before_unit
            arr = Split(before_unit, "-")
            If Not IsNumeric(arr(1)) Then
                MsgBox "新しいユニット名を見繕うとしましたがユニット名がヘンです。 " & before_unit & vbCrLf & "終了します。", Buttons:=vbInformation
                End
            End If
            latest_unit = Val(arr(1))
            latest_unit = latest_unit + 1
            newunit = arr(0) + "-" + Str(latest_unit)
            Debug.Print "newunit: " & newunit
            SNAME = "運転予定時間"
            wb1.Worksheets(SNAME).Activate
            wb1.Worksheets(SNAME).Range("B3").End(xlDown).Activate       ' セルB3[運転種別]から最終行へ
            Debug.Print "wb1 Last: " & wb1.Worksheets(SNAME).Range("B3").End(xlDown).Row
            targetline = wb1.Worksheets(SNAME).Range("B3").End(xlDown).Row
            wb1.Worksheets(SNAME).Cells(targetline, 1).Activate
            If MsgBox("ここに新しいユニット " & newunit & "を入れていいですか？？", vbYesNo + vbQuestion, "newunit") = vbYes Then
                wb1.Worksheets(SNAME).Cells(targetline, 1) = newunit
            End If
            
            
            End
            
            
            
                        
        Case Else
            Debug.Print "Zzz..."
    End Select
    
End Sub
